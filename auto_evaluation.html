
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-√©valuation E32 MELEC</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); overflow: hidden; }
        .header { background: linear-gradient(45deg, #2d3436, #636e72); color: white; padding: 40px; text-align: center; }
        .section { padding: 30px; border-bottom: 1px solid #eee; }
        .section:last-child { border-bottom: none; }
        .competence { margin: 25px 0; padding: 20px; background: #f8f9fa; border-radius: 12px; border-left: 6px solid #007cba; }
        .scale { display: flex; justify-content: space-between; margin: 20px 0; background: white; padding: 20px; border-radius: 10px; box-shadow: inset 0 2px 10px rgba(0,0,0,0.1); }
        .scale-level { text-align: center; cursor: pointer; padding: 10px; border-radius: 8px; transition: all 0.3s; font-weight: bold; }
        .scale-level:hover { background: #e9ecef; }
        .scale-level.selected { background: #007cba; color: white; transform: scale(1.1); }
        .video-help { background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px; display: none; }
        .qr-container { text-align: center; margin: 30px 0; padding: 20px; background: #f8f9fa; border-radius: 12px; }
        .btn { padding: 15px 30px; background: linear-gradient(45deg, #00b894, #00cec9); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: bold; margin: 10px; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,184,148,0.3); }
        .btn-warning { background: linear-gradient(45deg, #fdcb6e, #e17055); }
        .prof-grid { background: #e8f5e8; padding: 25px; margin-top: 20px; border-radius: 12px; }
        .qr-code { margin: 20px auto; }
        @media (max-width: 768px) { .scale { flex-direction: column; gap: 10px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä AUTO-√âVALUATION E32 MAINTENANCE</h1>
            <p>BAC PRO MELEC - Apr√®s chaque partie de la s√©quence</p>
            <div style="margin-top: 20px;">
                <strong>Nom : </strong><input type="text" id="nomEval" style="padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ddd;">
                <strong>Partie : </strong>
                <select id="partie">
                    <option>1 - Pr√©ventive</option>
                    <option>2 - Corrective</option>
                    <option>3 - √âpreuve</option>
                </select>
            </div>
        </div>

        <div class="section">
            <h2>üéØ √âvaluation des comp√©tences C10-C13</h2>

            <div class="competence">
                <h3>C10 - Maintenance pr√©ventive</h3>
                <div class="scale">
                    <div class="scale-level" data-value="1" onclick="selectLevel(this)">1<br>Besoin aide totale</div>
                    <div class="scale-level" data-value="2" onclick="selectLevel(this)">2<br>Fiche n√©cessaire</div>
                    <div class="scale-level" data-value="3" onclick="selectLevel(this)">3<br>Autonome valeurs</div>
                    <div class="scale-level" data-value="4" onclick="selectLevel(this)">4<br>Ma√Ætrise compl√®te</div>
                </div>
                <div class="video-help" id="helpC10">
                    <strong>üì∫ Aide vid√©o :</strong> <a href="#" target="_blank">Maintenance pr√©ventive coffret</a>
                </div>
            </div>

            <div class="competence">
                <h3>C11 - Maintenance corrective</h3>
                <div class="scale">
                    <div class="scale-level" data-value="1" onclick="selectLevel(this)">1<br>Perdu sympt√¥mes</div>
                    <div class="scale-level" data-value="2" onclick="selectLevel(this)">2<br>Diagnostic guid√©</div>
                    <div class="scale-level" data-value="3" onclick="selectLevel(this)">3<br>Diagnostic fiable</div>
                    <div class="scale-level" data-value="4" onclick="selectLevel(this)">4<br>Rapidit√© + fiabilit√©</div>
                </div>
                <div class="video-help" id="helpC11">
                    <strong>üì∫ Aide vid√©o :</strong> <a href="#" target="_blank">Diagnostic panne m√©thodique</a>
                </div>
            </div>

            <div class="competence">
                <h3>C12 - Communication s√©curit√©</h3>
                <div class="scale">
                    <div class="scale-level" data-value="1" onclick="selectLevel(this)">1<br>Oublie s√©curit√©</div>
                    <div class="scale-level" data-value="2" onclick="selectLevel(this)">2<br>Rappels n√©cessaires</div>
                    <div class="scale-level" data-value="3" onclick="selectLevel(this)">3<br>S√©curit√© syst√©matique</div>
                    <div class="scale-level" data-value="4" onclick="selectLevel(this)">4<br>Exemplaire B1V/BR</div>
                </div>
            </div>

            <div class="competence">
                <h3>C13 - Tra√ßabilit√©</h3>
                <div class="scale">
                    <div class="scale-level" data-value="1" onclick="selectLevel(this)">1<br>Fiche incompl√®te</div>
                    <div class="scale-level" data-value="2" onclick="selectLevel(this)">2<br>Basique</div>
                    <div class="scale-level" data-value="3" onclick="selectLevel(this)">3<br>Complet + photos</div>
                    <div class="scale-level" data-value="4" onclick="selectLevel(this)">4<br>Professionnel</div>
                </div>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <h3>Moyenne comp√©tences : <span id="moyenne">0</span>/4</h3>
                <div id="niveauGlobal"></div>
            </div>
        </div>

        <div class="section">
            <h2>üìù Commentaires libres</h2>
            <textarea id="commentaires" placeholder="Ce qui s'est bien pass√©... Ce qui peut √™tre am√©lior√©... Questions..." style="width:100%; height:120px; padding:20px; border:2px solid #ddd; border-radius:12px; font-size:16px; resize:vertical;"></textarea>
        </div>

        <div class="section prof-grid">
            <h2>üë®‚Äçüè´ GRILLE PROFESSEUR (QR Code)</h2>
            <div class="qr-container">
                <div id="qrCode" class="qr-code"></div>
                <p>Scanner pour saisir notes prof depuis smartphone</p>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px;">
                <div>Observation s√©curit√© : <select><option>Parfait</option><option>Attention</option><option>Critique</option></select></div>
                <div>Autonomie : <select><option>Guid√©</option><option>Semi</option><option>Autonome</option></select></div>
                <div>Note globale : <input type="number" min="0" max="20"></div>
            </div>
        </div>

        <div style="text-align: center; padding: 40px;">
            <button class="btn" onclick="saveEvaluation()">üíæ Sauvegarder √©valuation</button>
            <button class="btn btn-warning" onclick="exportPDF()">üìÑ Exporter PDF complet</button>
            <button class="btn" onclick="resetEvaluation()">üîÑ Nouvelle √©valuation</button>
        </div>
    </div>

    <script>
        const competences = ['C10', 'C11', 'C12', 'C13'];
        let scores = {};

        function selectLevel(el) {
            const comp = el.parentElement.parentElement.querySelector('h3').textContent;
            const value = parseInt(el.dataset.value);

            // D√©s√©lectionner autres dans m√™me √©chelle
            el.parentElement.querySelectorAll('.scale-level').forEach(l => l.classList.remove('selected'));
            el.classList.add('selected');

            scores[comp] = value;
            updateMoyenne();

            // Aide vid√©o si < 3
            if(value < 3) {
                const helpId = 'help' + comp;
                document.getElementById(helpId).style.display = 'block';
            }
        }

        function updateMoyenne() {
            const total = Object.values(scores).reduce((a,b) => a+b, 0);
            const moyenne = total / competences.length;
            document.getElementById('moyenne').textContent = moyenne.toFixed(1);

            const niveauEl = document.getElementById('niveauGlobal');
            if(moyenne >= 3.5) {
                niveauEl.innerHTML = '<div style="background:#d4edda;color:#155724;padding:15px;border-radius:10px;font-weight:bold;">üöÄ AUTONOME - Pr√™t √©preuve !</div>';
            } else if(moyenne >= 2.5) {
                niveauEl.innerHTML = '<div style="background:#fff3cd;color:#856404;padding:15px;border-radius:10px;font-weight:bold;">üìö SEMI-AUTONOME - Consolidation</div>';
            } else {
                niveauEl.innerHTML = '<div style="background:#f8d7da;color:#721c24;padding:15px;border-radius:10px;font-weight:bold;">üë∂ GUID√â - Travail approfondi</div>';
            }
        }

        function saveEvaluation() {
            localStorage.setItem('e32_eval_' + Date.now(), JSON.stringify({
                nom: document.getElementById('nomEval').value,
                partie: document.getElementById('partie').value,
                scores: scores,
                commentaires: document.getElementById('commentaires').value,
                date: new Date().toISOString()
            }));
            alert('üíæ √âvaluation sauvegard√©e !');
        }

        function resetEvaluation() {
            scores = {};
            document.querySelectorAll('.scale-level').forEach(l => l.classList.remove('selected'));
            document.getElementById('moyenne').textContent = '0';
            document.getElementById('commentaires').value = '';
            document.getElementById('niveauGlobal').innerHTML = '';
        }

        async function exportPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();

            pdf.setFontSize(22);
            pdf.text('AUTO-√âVALUATION E32 MELEC', 20, 25);

            pdf.setFontSize(14);
            pdf.text(`√âl√®ve : ${document.getElementById('nomEval').value}`, 20, 45);
            pdf.text(`Partie : ${document.getElementById('partie').value}`, 20, 55);
            pdf.text(`Moyenne : ${document.getElementById('moyenne').textContent}/4`, 20, 65);

            let y = 85;
            for(let comp of competences) {
                pdf.text(`${comp} : ${scores[comp] || 0}/4`, 20, y);
                y += 10;
            }

            pdf.text('Commentaires :', 20, y);
            y += 10;
            pdf.text(document.getElementById('commentaires').value.substring(0,100) + '...', 20, y);

            pdf.save('AutoEvaluation_E32.pdf');
        }

        // QR Code grille prof
        QRCode.toCanvas(document.getElementById('qrCode'), 'https://your-school-link/e32-prof-grid', {
            width: 200,
            margin: 2,
            color: {
                dark: '#000000',
                light: '#FFFFFF'
            }
        }, function (error) {
            if (error) console.error(error);
        });

        // Load saved
        window.onload = () => {
            const nom = localStorage.getItem('nomEval') || '';
            document.getElementById('nomEval').value = nom;
        };
    </script>
</body>
</html>
