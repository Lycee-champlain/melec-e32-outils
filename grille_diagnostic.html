
<!DOCTYPE html>
<html lang=\"fr\">
<head>
    <meta charset=\"UTF-8\">
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    <title>Grille Diagnostic Interactif - E32 MELEC</title>
    <script src=\"https://html2canvas.hertzen.com/dist/html2canvas.min.js\"></script>
    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: #e5e7eb; padding: 20px; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; background: #0b1120; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.5); overflow: hidden; border: 1px solid #1f293b; }
        .header { background: linear-gradient(135deg, #1d4ed8, #22c55e); color: white; padding: 25px 30px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 22px; margin: 0; }
        .scenario-select { padding: 15px 20px; background: #020617; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1f293b; }
        .scenario-select select { padding: 10px 15px; border-radius: 8px; border: 1px solid #4b5563; background: #020617; color: #e5e7eb; font-size: 14px; min-width: 300px; }
        .step-badge { background: #059669; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .content { display: flex; flex-wrap: wrap; }
        .left, .right { padding: 25px; }
        .left { flex: 1 1 400px; border-right: 1px solid #1f293b; }
        .right { flex: 1 1 400px; background: #020617; }
        h2 { color: #e5e7eb; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .card { background: #020617; border-radius: 12px; padding: 18px; margin-bottom: 20px; border: 1px solid #1f293b; }
        .btn { padding: 12px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; font-size: 14px; margin: 5px; transition: all 0.3s; }
        .btn-primary { background: #2563eb; color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-secondary { background: transparent; color: #e5e7eb; border: 2px solid #4b5563; }
        .btn-secondary:hover { background: #1f2937; border-color: #6b7280; }
        .btn-success { background: #16a34a; color: white; }
        .multimeter { background: #0f172a; border-radius: 16px; padding: 20px; border: 2px solid #1f293b; margin: 15px 0; }
        .multimeter-screen { background: #111827; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 20px; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        .screen-mode { font-size: 28px; font-family: 'Consolas', monospace; color: #22c55e; margin: 10px 0; }
        .screen-value { font-size: 36px; font-family: 'Consolas', monospace; color: #facc15; font-weight: bold; }
        .input-group { display: flex; align-items: center; gap: 10px; margin: 12px 0; }
        .input-group label { min-width: 140px; color: #9ca3af; font-size: 14px; }
        .input-group input, .input-group select { padding: 10px 12px; border-radius: 8px; border: 1px solid #4b5563; background: #020617; color: #e5e7eb; font-size: 14px; flex: 1; max-width: 120px; }
        .input-group button { padding: 10px 16px; flex-shrink: 0; }
        .feedback { margin-top: 15px; padding: 12px; border-radius: 10px; font-weight: 500; }
        .feedback-ok { background: rgba(22, 163, 74, 0.2); color: #bbf7d0; border: 1px solid #16a34a; }
        .feedback-bad { background: rgba(185, 28, 28, 0.2); color: #fecaca; border: 1px solid #b91c1c; }
        .log { max-height: 250px; overflow-y: auto; font-size: 13px; padding: 10px; background: #020617; border-radius: 10px; border: 1px solid #1f293b; }
        .log-entry { padding: 8px 0; border-bottom: 1px solid #1f293b; }
        .log-entry:last-child { border-bottom: none; }
        .conclusion { margin-top: 15px; padding: 15px; border-radius: 12px; background: rgba(59, 130, 246, 0.1); border: 1px solid #2563eb; }
        .hypo-correct { background: #d1fae5 !important; color: #065f46 !important; }
        @media (max-width: 900px) { .content { flex-direction: column; } .left { border-right: none; border-bottom: 1px solid #1f293b; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>üîç Diagnostic + Multim√®tre virtuel</h1>
                <p>E32 Maintenance corrective - BAC PRO MELEC</p>
            </div>
            <button class="btn btn-secondary" onclick="resetScenario()">üîÑ Nouvelle panne</button>
        </div>

        <div class="scenario-select">
            <div>
                <label style="font-size: 14px;">Choisir la panne :</label>
                <select id="scenarioSelect" onchange="loadScenario()">
                    <option value="prise">üöø Prise 16A atelier HS</option>
                    <option value="moteur">üåÄ Moteur VMC ne d√©marre pas</option>
                    <option value="eclairage">üí° Va-et-vient √©clairage HS</option>
                </select>
            </div>
            <div class="step-badge">√âtape : <span id="stepLabel">1/4 - Sympt√¥mes</span></div>
        </div>

        <div class="content">
            <div class="left">
                <div class="card">
                    <h2>üìã Sympt√¥mes observ√©s</h2>
                    <div id="symptomesCard"></div>
                </div>

                <div class="card">
                    <h2>üß† Hypoth√®se s√©lectionn√©e</h2>
                    <div id="hypothesesCard"></div>
                </div>

                <div class="card">
                    <h2>üß™ Tests disponibles</h2>
                    <div id="testsCard"></div>
                </div>
            </div>

            <div class="right">
                <div class="card">
                    <h2>‚ö° Multim√®tre virtuel</h2>
                    <div class="multimeter">
                        <div class="multimeter-screen">
                            <div class="screen-mode" id="screenMode">S√©lectionnez mode</div>
                            <div class="screen-value" id="screenValue">0.00</div>
                            <div style="font-size:12px;color:#9ca3af;">Valeur mesur√©e en temps r√©el</div>
                        </div>

                        <div class="multimeter-controls">
                            <div class="input-group">
                                <label>Type de mesure :</label>
                                <select id="mesureType" onchange="updateMode()">
                                    <option value="">---</option>
                                    <option value="tension">Tension (V)</option>
                                    <option value="intensite">Intensit√© (A)</option>
                                    <option value="isolement">Isolation (MŒ©)</option>
                                    <option value="continuite">Continuit√© (kŒ©)</option>
                                </select>
                            </div>

                            <div class="input-group">
                                <label>Valeur attendue :</label>
                                <input type="number" id="valAttendue" step="0.01" placeholder="230" min="0">
                                <select id="unitAttendue">
                                    <option>V</option>
                                    <option>A</option>
                                    <option>MŒ©</option>
                                    <option>kŒ©</option>
                                </select>
                            </div>

                            <div class="input-group">
                                <label>Valeur mesur√©e :</label>
                                <input type="number" id="valMesuree" step="0.01" placeholder="0" min="0" oninput="updateScreen()">
                                <select id="unitMesuree" onchange="updateScreen()">
                                    <option>V</option>
                                    <option>A</option>
                                    <option>MŒ©</option>
                                    <option>kŒ©</option>
                                </select>
                            </div>

                            <div class="input-group">
                                <label>Tol√©rance :</label>
                                <input type="number" id="tolerance" value="5" step="1" min="0" max="50" style="width:80px;"> %
                                <button class="btn btn-primary" onclick="validerMesure()">‚úÖ Valider mesure</button>
                            </div>

                            <div id="measureFeedback" style="margin-top:15px;"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>üìä Historique des tests</h2>
                    <div class="log" id="logTests"></div>
                </div>

                <div class="card" id="conclusionBloc" style="display:none;">
                    <h2>üéØ Conclusion diagnostic</h2>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scenarios = {
            prise: {
                symptomes: \"Prise 16A atelier ne fonctionne plus depuis ce matin. Autres prises OK. Disjoncteur enclench√©.\",
                hypotheses: [
                    { id: 'h1', text: 'Borne desserr√©e dans la prise', correct: true },
                    { id: 'h2', text: 'Disjoncteur g√©n√©ral HS', correct: false },
                    { id: 'h3', text: 'C√¢ble principal coup√©', correct: false }
                ],
                tests: [
                    { id: 't1', text: 'Tension aux bornes prise', type: 'tension', attendu: 230, unite: 'V', valeurReelle: 0 },
                    { id: 't2', text: 'Continuit√© phase prise', type: 'continuite', attendu: 0.1, unite: 'kŒ©', valeurReelle: 15 },
                    { id: 't3', text: 'Isolement prise-ter Ascertain', type: 'isolement', attendu: 1, unite: 'MŒ©', valeurReelle: 0.8 }
                ],
                conclusion: \"Borne desserr√©e dans la prise. Resserrer + tester.\"
            },
            moteur: {
                symptomes: \"Moteur VMC ne d√©marre plus. Disjoncteur OK. Odeur suspecte hier.\",
                hypotheses: [
                    { id: 'h1', text: 'Condensateur permanent HS', correct: true },
                    { id: 'h2', text: 'Protection thermique', correct: false },
                    { id: 'h3', text: 'Moteur grill√©', correct: false }
                ],
                tests: [
                    { id: 't1', text: 'Tension bornes moteur', type: 'tension', attendu: 230, unite: 'V', valeurReelle: 230 },
                    { id: 't2', text: 'Isolement enroulements', type: 'isolement', attendu: 1, unite: 'MŒ©', valeurReelle: 0.3 },
                    { id: 't3', text: 'Continuit√© condensateur', type: 'continuite', attendu: 0.1, unite: 'kŒ©', valeurReelle: 999 }
                ],
                conclusion: \"Condensateur HS. Remplacer par r√©f√©rence identique.\"
            },
            eclairage: {
                symptomes: \"Va-et-vient √©clairage couloir HS. Lampes neuves. Disjoncteur OK.\",
                hypotheses: [
                    { id: 'h1', text: 'Fil navette coup√©', correct: true },
                    { id: 'h2', text: 'Interrupteur HS', correct: false },
                    { id: 'h3', text: 'Phase coup√©e', correct: false }
                ],
                tests: [
                    { id: 't1', text: 'Tension sortie disjoncteur', type: 'tension', attendu: 230, unite: 'V', valeurReelle: 230 },
                    { id: 't2', text: 'Continuit√© fil navette', type: 'continuite', attendu: 0.1, unite: 'kŒ©', valeurReelle: 9999 },
                    { id: 't3', text: 'Continuit√© interrupteurs', type: 'continuite', attendu: 0.1, unite: 'kŒ©', valeurReelle: 0.05 }
                ],
                conclusion: \"Fil navette coup√©. Localiser + √©pisser/r√©parer.\"
            }
        };

        let currentScenario = 'prise';
        let chosenHypothesis = null;
        let chosenTest = null;
        let testsHistory = [];

        function loadScenario() {
            currentScenario = document.getElementById('scenarioSelect').value;
            resetDiagnostic();
            renderSymptomes();
        }

        function renderSymptomes() {
            const sc = scenarios[currentScenario];
            document.getElementById('symptomesCard').innerHTML = `
                <div class=\"badge badge-sympt\">SYMPT√îMES</div>
                <p>${sc.symptomes}</p>
            `;
        }

        function renderHypotheses() {
            const sc = scenarios[currentScenario];
            let html = '<p>Choisissez l\'hypoth√®se la plus probable :</p>';
            sc.hypotheses.forEach(h => {
                html += `<button class=\"btn btn-secondary\" onclick=\"selectHypothesis('${h.id}', '${h.text}')\" style=\"width:100%;margin:4px 0;\">${h.text}</button>`;
            });
            document.getElementById('hypothesesCard').innerHTML = html;
        }

        function renderTests() {
            const sc = scenarios[currentScenario];
            let html = '<p>Test √† effectuer :</p>';
            sc.tests.forEach(t => {
                html += `<button class=\"btn btn-secondary\" onclick=\"selectTest('${t.id}', '${t.text}')\" style=\"width:100%;margin:4px 0;\">${t.text}</button>`;
            });
            document.getElementById('testsCard').innerHTML = html;
        }

        function selectHypothesis(id, text) {
            chosenHypothesis = id;
            document.getElementById('hypothesesCard').innerHTML = `<div class=\"hypo-correct\"><strong>Hypoth√®se : ${text}</strong></div>`;
            renderTests();
        }

        function selectTest(id, text) {
            chosenTest = id;
            document.getElementById('testsCard').innerHTML = `<div><strong>Test s√©lectionn√© : ${text}</strong></div><p>Configurez le multim√®tre et saisissez la mesure.</p>`;
        }

        function updateMode() {
            const type = document.getElementById('mesureType').value;
            if (type) {
                const modes = {
                    tension: 'Tension',
                    intensite: 'Intensit√©', 
                    isolement: 'Isolation',
                    continuite: 'Continuit√©'
                };
                document.getElementById('screenMode').textContent = modes[type];
            }
        }

        function updateScreen() {
            const val = parseFloat(document.getElementById('valMesuree').value) || 0;
            const unit = document.getElementById('unitMesuree').value;
            document.getElementById('screenValue').textContent = val.toFixed(2) + unit;
        }

        function validerMesure() {
            if (!chosenHypothesis || !chosenTest) {
                alert('Choisissez d'abord une hypoth√®se puis un test !');
                return;
            }

            const sc = scenarios[currentScenario];
            const test = sc.tests.find(t => t.id === chosenTest);
            const valAtt = parseFloat(document.getElementById('valAttendue').value);
            const valMes = parseFloat(document.getElementById('valMesuree').value);
            const tol = parseFloat(document.getElementById('tolerance').value);
            const unitA = document.getElementById('unitAttendue').value;
            const unitM = document.getElementById('unitMesuree').value;

            const conforme = Math.abs(valMes - valAtt) <= (valAtt * tol / 100);

            // Ajout au log
            testsHistory.push({
                test: test.text,
                attendu: valAtt + ' ' + unitA,
                mesure: valMes + ' ' + unitM,
                conforme: conforme,
                hypo: sc.hypotheses.find(h => h.id === chosenHypothesis).text
            });

            renderLog();
            renderConclusion();

            // Reset multim√®tre
            document.getElementById('valMesuree').value = '';
            document.getElementById('screenValue').textContent = '0.00';
        }

        function renderLog() {
            let html = '';
            testsHistory.forEach((entry, i) => {
                const status = entry.conforme ? '‚úÖ OK' : '‚ö†Ô∏è KO';
                html += `
                    <div class=\"log-entry\">
                        <strong>${entry.test}</strong><br>
                        Attendue : ${entry.attendu} | Mesur√©e : ${entry.mesure}<br>
                        <span style=\"color:${entry.conforme ? '#bbf7d0' : '#fecaca'}\">${status}</span>
                    </div>
                `;
            });
            document.getElementById('logTests').innerHTML = html;
        }

        function renderConclusion() {
            const sc = scenarios[currentScenario];
            const hypo = sc.hypotheses.find(h => h.id === chosenHypothesis);
            let html = '<h3>üéØ Conclusion</h3>';

            if (hypo.correct) {
                html += '<div style="background:rgba(22,163,74,0.2);padding:12px;border-radius:10px;border-left:4px solid #16a34a;">';
                html += '<strong>‚úÖ BONNE PISTE :</strong> ' + hypo.text;
            } else {
                html += '<div style="background:rgba(185,28,28,0.2);padding:12px;border-radius:10px;border-left:4px solid #b91c1c;">';
                html += '<strong>‚ö†Ô∏è PISTE FAIBLE :</strong> ' + hypo.text;
            }

            html += '</div>';
            html += '<p style="margin-top:12px;"><strong>Cause r√©elle :</strong> ' + sc.conclusion + '</p>';
            document.getElementById('conclusionBloc').innerHTML = html;
            document.getElementById('conclusionBloc').style.display = 'block';
        }

        function resetScenario() {
            chosenHypothesis = null;
            chosenTest = null;
            testsHistory = [];
            step = 1;
            document.getElementById('logTests').innerHTML = '';
            document.getElementById('conclusionBloc').style.display = 'none';
            document.getElementById('valMesuree').value = '';
            document.getElementById('screenValue').textContent = '0.00';
            renderSymptomes();
            renderHypotheses();
            renderTests();
        }

        // Initialisation
        window.onload = () => {
            loadScenario();
        };
    </script>
</body>
</html>
