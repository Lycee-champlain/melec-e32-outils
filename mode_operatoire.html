
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mode Op√©ratoire Maintenance - E32 MELEC</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .step { background: white; margin: 20px 0; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: all 0.3s; }
        .step.locked { opacity: 0.5; background: #f8f9fa; }
        .step.completed { border-left: 8px solid #28a745; background: #f8fff9; }
        .step-title { font-size: 22px; margin-bottom: 15px; display: flex; align-items: center; }
        .step-number { background: #007cba; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; }
        .checkbox-large { transform: scale(2); margin-right: 15px; }
        .timer { font-size: 24px; font-weight: bold; color: #dc3545; margin: 20px 0; }
        .actions { margin-top: 20px; }
        .btn { padding: 12px 24px; margin: 5px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s; }
        .btn-primary { background: #007cba; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; width: 100%; padding: 20px; font-size: 20px; margin-top: 30px; border-radius: 12px; }
        .feedback { padding: 15px; margin: 15px 0; border-radius: 8px; font-weight: bold; }
        .feedback.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .progress-bar { width: 100%; height: 10px; background: #e9ecef; border-radius: 5px; margin: 20px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #28a745, #007cba); transition: width 0.5s; }
        @media (max-width: 768px) { .step { padding: 20px; } .step-title { font-size: 18px; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚öôÔ∏è MODE OP√âRATOIRE MAINTENANCE √âLECTRIQUE</h1>
        <p>E32 BAC PRO MELEC - Applicable √† TOUS supports</p>
        <div class="timer" id="totalTimer">Temps total : 00:00</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <div id="progressText">√âtape 0/6 - Commencer √©tape 1</div>
    </div>

    <div class="step completed" id="step0">
        <div class="step-title">
            <span class="step-number">0</span>
            <h2>üöÄ PR√âPARATION</h2>
        </div>
        <p><strong>Nom : </strong><input type="text" id="nomEtape0" style="padding: 5px; font-size: 16px;"><br>
        <strong>Support : </strong><input type="text" id="support" style="padding: 5px; font-size: 16px;"><br>
        <strong>Type : </strong>
        <label><input type="radio" name="type" value="preventive"> Pr√©ventive</label>
        <label><input type="radio" name="type" value="corrective"> Corrective</label>
        </p>
        <div class="actions">
            <button class="btn btn-success" onclick="startStep1()">‚ñ∂Ô∏è COMMENCER √âTAPE 1</button>
        </div>
    </div>

    <div class="step locked" id="step1">
        <div class="step-title">
            <span class="step-number">1</span>
            <h2>üîê PRISE CONNAISSANCE + S√âCURIT√â</h2>
        </div>
        <div class="checklist">
            <input type="checkbox" class="checkbox-large" id="s1-1" onchange="checkSecurity1()">
            <span>Signature fiche s√©curit√© B1V/BR</span>
        </div>
        <div class="checklist">
            <input type="checkbox" class="checkbox-large" id="s1-2" onchange="checkSecurity1()">
            <span>VAT pr√©vue (3 points minimum)</span>
        </div>
        <div class="checklist">
            <input type="checkbox" class="checkbox-large" id="s1-3" onchange="checkSecurity1()">
            <span>EPI v√©rifi√©s (gants classe 00)</span>
        </div>
        <div id="feedback1" class="feedback"></div>
        <div class="timer" id="timer1">√âtape 1 : 00:00</div>
    </div>

    <div class="step locked" id="step2">
        <div class="step-title">
            <span class="step-number">2</span>
            <h2>üîç ANALYSE SITUATION</h2>
        </div>
        <textarea id="analyse" placeholder="D√©crire l'analyse de la situation (gamme ou sympt√¥mes)..." style="width:100%; height:120px; padding:15px; margin:20px 0; font-size:16px;"></textarea>
        <div class="timer" id="timer2">√âtape 2 : 00:00</div>
    </div>

    <div class="step locked" id="step3">
        <div class="step-title">
            <span class="step-number">3</span>
            <h2>üí° HYPOTH√àSES + CONTR√îLES</h2>
        </div>
        <div id="hypotheses">
            <div class="hypo"><input type="text" placeholder="Hypoth√®se 1" class="hypo-input"><button onclick="deleteHypo(this)">‚ùå</button></div>
        </div>
        <button class="btn btn-primary" onclick="addHypo()">‚ûï Ajouter hypoth√®se</button>
        <div class="timer" id="timer3">√âtape 3 : 00:00</div>
    </div>

    <div class="step locked" id="step4">
        <div class="step-title">
            <span class="step-number">4</span>
            <h2>üîß R√âALISATION + MESURES</h2>
        </div>
        <table style="width:100%; border-collapse: collapse; margin:10px 0;">
            <tr><th>Mesure</th><th>Valeur attendue</th><th>Mesur√©e</th><th>Conforme</th></tr>
            <tr><td>Isolement</td><td>&ge;0.5 MŒ©</td><td><input type="number" step="0.1" class="measure"></td><td><input type="checkbox"></td></tr>
            <tr><td>Continuit√© terre</td><td>&le;2 Œ©</td><td><input type="number" step="0.1" class="measure"></td><td><input type="checkbox"></td></tr>
            <tr><td>Diff√©rentiel</td><td>15-30mA</td><td><input type="number" step="1" class="measure"></td><td><input type="checkbox"></td></tr>
        </table>
        <div class="timer" id="timer4">√âtape 4 : 00:00</div>
    </div>

    <div class="step locked" id="step5">
        <div class="step-title">
            <span class="step-number">5</span>
            <h2>‚úÖ REMISE EN SERVICE</h2>
        </div>
        <div class="checklist">
            <input type="checkbox" class="checkbox-large" id="s5-1">
            <span>Fonctionnement √† vide OK</span>
        </div>
        <div class="checklist">
            <input type="checkbox" class="checkbox-large" id="s5-2">
            <span>Fonctionnement en charge OK</span>
        </div>
        <div class="checklist">
            <input type="checkbox" class="checkbox-large" id="s5-3">
            <span>S√©curit√© protections OK</span>
        </div>
        <div class="timer" id="step5-timer">√âtape 5 : 00:00</div>
    </div>

    <div class="step locked" id="step6">
        <div class="step-title">
            <span class="step-number">6</span>
            <h2>üìÑ COMPTE-RENDU</h2>
        </div>
        <textarea id="conclusion" placeholder="R√©sum√© intervention, anomalies, pr√©conisations..." style="width:100%; height:150px;"></textarea>
        <div class="timer" id="timer6">√âtape 6 : 00:00</div>
        <div class="actions">
            <button class="btn btn-success" onclick="completeMO()">‚úÖ TERMINER MAINTENANCE</button>
            <button class="btn btn-primary" onclick="exportPDF()">üìÑ Exporter rapport PDF</button>
        </div>
    </div>

    <button class="btn-danger" onclick="emergencyStop()" style="margin-top: 40px;">
        üö® UR GENCE S√âCURIT√â - ARR√äT IMM√âDIAT
    </button>

    <script>
        let currentStep = 0;
        let totalTime = 0;
        let timers = {};
        let startTime = Date.now();

        const stepTitles = ['step0', 'step1', 'step2', 'step3', 'step4', 'step5', 'step6'];

        // Timer global
        setInterval(() => {
            totalTime = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('totalTimer').textContent = `Temps total : ${formatTime(totalTime)}`;
        }, 1000);

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
        }

        // S√©curit√© √©tape 1
        function checkSecurity1() {
            const checks = ['s1-1', 's1-2', 's1-3'];
            const complete = checks.every(id => document.getElementById(id).checked);
            const feedback = document.getElementById('feedback1');

            if(complete) {
                feedback.innerHTML = '<div class="feedback success">‚úÖ S√©curit√© valid√©e ! Passer √† l\'√©tape 2</div>';
                setTimeout(() => unlockStep(2), 2000);
            } else {
                feedback.innerHTML = '<div class="feedback error">‚ö†Ô∏è Compl√©ter s√©curit√© avant de continuer !</div>';
            }
        }

        // D√©verrouillage √©tapes
        function unlockStep(n) {
            if(n > currentStep) currentStep = n;
            for(let i=0; i<=currentStep; i++) {
                document.getElementById(stepTitles[i]).classList.remove('locked');
                if(i < currentStep) document.getElementById(stepTitles[i]).classList.add('completed');
            }
            updateProgress();
            startStepTimer(n);
        }

        function updateProgress() {
            const progress = (currentStep / 6) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `√âtape ${currentStep}/6`;
        }

        function startStep1() {
            unlockStep(1);
        }

        function startStepTimer(stepNum) {
            if(!timers[stepNum]) {
                timers[stepNum] = { start: Date.now() };
                const timerEl = document.getElementById('timer' + stepNum);
                const interval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - timers[stepNum].start) / 1000);
                    timerEl.textContent = `√âtape ${stepNum} : ${formatTime(elapsed)}`;
                }, 1000);
                timers[stepNum].interval = interval;
            }
        }

        // Hypoth√®ses dynamiques
        function addHypo() {
            const div = document.createElement('div');
            div.className = 'hypo';
            div.innerHTML = `<input type="text" placeholder="Hypoth√®se ${document.querySelectorAll('.hypo').length + 1}" class="hypo-input">
                            <button onclick="deleteHypo(this)">‚ùå</button>`;
            document.getElementById('hypotheses').appendChild(div);
            if(document.querySelectorAll('.hypo').length >= 3) unlockStep(4);
        }

        function deleteHypo(btn) {
            btn.parentElement.remove();
        }

        function completeMO() {
            if(document.getElementById('conclusion').value) {
                alert('üéâ Maintenance termin√©e avec succ√®s ! Rapport export√©.');
                updateProgress();
            } else {
                alert('‚ö†Ô∏è Compl√©ter la conclusion avant de terminer.');
            }
        }

        // Urgence
        function emergencyStop() {
            alert('üö® ARR√äT IMM√âDIAT !\n\n1. Couper alimentation g√©n√©rale\n2. Alerter professeur\n3. √âvacuer zone\n\nTemps d\'arr√™t enregistr√©.');
            document.body.innerHTML = '<h1 style="color:red; text-align:center; padding:50px;">üö® INTERVENTION ARR√äT√âE - S√âCURIT√â</h1>';
        }

        // Export PDF
        async function exportPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();

            pdf.setFontSize(20);
            pdf.text('RAPPORT MAINTENANCE E32 MELEC', 20, 20);

            pdf.setFontSize(14);
            pdf.text(`√âl√®ve : ${document.getElementById('nomEtape0').value}`, 20, 40);
            pdf.text(`Support : ${document.getElementById('support').value}`, 20, 50);
            pdf.text(`Temps total : ${formatTime(totalTime)}`, 20, 60);

            pdf.text('Mode op√©ratoire complet', 20, 80);
            pdf.text(document.getElementById('analyse').value.substring(0,100) + '...', 20, 90);

            pdf.save('Rapport_Maintenance_E32.pdf');
        }

        // LocalStorage
        window.onload = () => {
            document.getElementById('nomEtape0').value = localStorage.getItem('nom') || '';
            // Charger autres donn√©es...
        };
    </script>
</body>
</html>
