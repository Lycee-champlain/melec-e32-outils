
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habilitation B1V/BR - E32 MELEC</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #dc2626; /* Rouge Sécurité */
            --primary-dark: #b91c1c;
            --secondary: #1e293b;
            --success: #16a34a;
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --text: #334155;
            --border: #e2e8f0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; min-height: 100vh; }

        .container { max-width: 800px; margin: 0 auto; background: var(--card-bg); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); overflow: hidden; }

        .header { background: var(--secondary); color: white; padding: 25px 30px; border-bottom: 4px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }
        .header-title h1 { font-size: 22px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .header-title p { font-size: 13px; opacity: 0.8; margin-top: 4px; }
        .header-badge { background: var(--primary); padding: 6px 12px; border-radius: 6px; font-weight: 700; font-size: 14px; }

        .form-section { padding: 30px; border-bottom: 1px solid var(--border); }
        .section-title { font-size: 18px; font-weight: 700; color: var(--secondary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .section-icon { width: 32px; height: 32px; background: #fee2e2; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: var(--text); }
        .input-group input, .input-group select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 15px; font-family: inherit; transition: 0.2s; }
        .input-group input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1); }

        .checklist { display: flex; flex-direction: column; gap: 12px; }
        .check-item { display: flex; align-items: flex-start; gap: 12px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; transition: 0.2s; background: #f8fafc; }
        .check-item:hover { background: #fef2f2; border-color: var(--primary); }
        .check-item input { margin-top: 3px; accent-color: var(--primary); transform: scale(1.2); }
        .check-item-content { flex: 1; }
        .check-title { font-weight: 600; font-size: 15px; margin-bottom: 2px; }
        .check-desc { font-size: 13px; color: #64748b; }

        .signature-pad { border: 2px dashed var(--border); border-radius: 8px; height: 160px; position: relative; background: #f8fafc; margin-top: 10px; cursor: crosshair; }
        .signature-pad:hover { background: #fff; border-color: var(--primary); }
        canvas { width: 100%; height: 100%; }
        .clear-sig { position: absolute; top: 10px; right: 10px; background: white; border: 1px solid var(--border); padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; }

        .actions { padding: 30px; background: #f8fafc; text-align: center; }
        .btn { padding: 14px 28px; border: none; border-radius: 8px; font-weight: 700; font-size: 16px; cursor: pointer; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--secondary); color: white; width: 100%; justify-content: center; }
        .btn-primary:hover { background: #0f172a; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2); }
        .btn-success { background: var(--success); color: white; }

        @media (max-width: 600px) {
            .container { border-radius: 0; box-shadow: none; }
            .header { padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <div class="header-title">
                <h1>Fiche de Sécurité</h1>
                <p>Habilitation Électrique B1V / BR</p>
            </div>
            <div class="header-badge">E32</div>
        </header>

        <!-- IDENTIFICATION -->
        <div class="form-section">
            <div class="section-title">
                <div class="section-icon">1</div>
                <span>Identification Intervenant</span>
            </div>
            <div class="input-group">
                <label>Nom & Prénom de l'élève</label>
                <input type="text" id="nomEleve" placeholder="Ex: DUPONT Thomas">
            </div>
            <div class="input-group">
                <label>Chargé de Travaux (Professeur)</label>
                <input type="text" id="nomProf" value="M. LE PROFESSEUR" readonly style="background:#f1f5f9;">
            </div>
            <div class="input-group">
                <label>Zone d'intervention</label>
                <select id="zoneIntervention">
                    <option value="">Sélectionner...</option>
                    <option>TGBT Atelier</option>
                    <option>Armoire Machine 1</option>
                    <option>Coffret Divisionnaire</option>
                </select>
            </div>
        </div>

        <!-- CONSIGNATION -->
        <div class="form-section">
            <div class="section-title">
                <div class="section-icon">2</div>
                <span>Procédure de Consignation</span>
            </div>
            <div class="checklist">
                <label class="check-item">
                    <input type="checkbox" id="c1">
                    <div class="check-item-content">
                        <div class="check-title">1. Séparation</div>
                        <div class="check-desc">Ouverture du sectionneur / disjoncteur principal.</div>
                    </div>
                </label>
                <label class="check-item">
                    <input type="checkbox" id="c2">
                    <div class="check-item-content">
                        <div class="check-title">2. Condamnation</div>
                        <div class="check-desc">Pose du cadenas et de l'étiquette de condamnation.</div>
                    </div>
                </label>
                <label class="check-item">
                    <input type="checkbox" id="c3">
                    <div class="check-item-content">
                        <div class="check-title">3. Identification</div>
                        <div class="check-desc">Vérification que l'ouvrage correspond bien au dossier.</div>
                    </div>
                </label>
                <label class="check-item">
                    <input type="checkbox" id="c4">
                    <div class="check-item-content">
                        <div class="check-title">4. VAT (Vérification d'Absence de Tension)</div>
                        <div class="check-desc">Test du VAT (autotest) + Mesure + Retest.</div>
                    </div>
                </label>
                <label class="check-item">
                    <input type="checkbox" id="c5">
                    <div class="check-item-content">
                        <div class="check-title">5. Mise à la terre (MALT)</div>
                        <div class="check-desc">Mise à la terre et en court-circuit (si nécessaire).</div>
                    </div>
                </label>
            </div>
        </div>

        <!-- EPI -->
        <div class="form-section">
            <div class="section-title">
                <div class="section-icon">3</div>
                <span>Équipements de Protection (EPI)</span>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <label class="check-item" style="padding:8px;">
                    <input type="checkbox" id="epi1"> <span style="font-size:14px; margin-left:8px;">Gants Isolants</span>
                </label>
                <label class="check-item" style="padding:8px;">
                    <input type="checkbox" id="epi2"> <span style="font-size:14px; margin-left:8px;">Écran Facial</span>
                </label>
                <label class="check-item" style="padding:8px;">
                    <input type="checkbox" id="epi3"> <span style="font-size:14px; margin-left:8px;">Tenue Coton</span>
                </label>
                <label class="check-item" style="padding:8px;">
                    <input type="checkbox" id="epi4"> <span style="font-size:14px; margin-left:8px;">Tapis Isolant</span>
                </label>
            </div>
        </div>

        <!-- SIGNATURE -->
        <div class="form-section" style="border-bottom:none;">
            <div class="section-title">
                <div class="section-icon">4</div>
                <span>Validation & Signature</span>
            </div>
            <p style="font-size:13px; color:#64748b; margin-bottom:10px;">Je certifie avoir réalisé toutes les étapes de consignation avant intervention.</p>

            <div class="signature-pad" id="sigContainer">
                <button class="clear-sig" onclick="clearSignature()">Effacer</button>
                <canvas id="sigCanvas"></canvas>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-primary" onclick="generatePDF()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                Valider & Télécharger PDF
            </button>
        </div>
    </div>

    <script>
        // Gestion Signature
        const canvas = document.getElementById('sigCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            ctx.scale(ratio, ratio);
        }
        window.onresize = resizeCanvas;
        setTimeout(resizeCanvas, 100);

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        ['mousedown', 'touchstart'].forEach(ev => {
            canvas.addEventListener(ev, (e) => {
                isDrawing = true;
                const pos = getPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                e.preventDefault();
            });
        });

        ['mousemove', 'touchmove'].forEach(ev => {
            canvas.addEventListener(ev, (e) => {
                if (!isDrawing) return;
                const pos = getPos(e);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                e.preventDefault();
            });
        });

        ['mouseup', 'touchend'].forEach(ev => {
            canvas.addEventListener(ev, () => isDrawing = false);
        });

        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Génération PDF
        async function generatePDF() {
            const nom = document.getElementById('nomEleve').value;
            if(nom.length < 2) { alert('Nom requis'); return; }

            // Vérif cases
            const checks = ['c1','c2','c3','c4','c5'].every(id => document.getElementById(id).checked);
            if(!checks) { alert('Toutes les étapes de consignation doivent être cochées !'); return; }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // En-tête Rouge Sécurité
            doc.setFillColor(220, 38, 38);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.text("FICHE DE SÉCURITÉ B1V", 20, 20);

            doc.setTextColor(0, 0, 0);
            doc.setFontSize(14);
            doc.text(`Intervenant : ${nom}`, 20, 50);
            doc.text(`Zone : ${document.getElementById('zoneIntervention').value}`, 20, 60);
            doc.text(`Date : ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`, 20, 70);

            doc.setDrawColor(0);
            doc.line(20, 80, 190, 80);

            doc.setFontSize(16);
            doc.text("CONSIGNATION VALIDÉE", 20, 100);
            doc.setFontSize(12);
            doc.text("1. Séparation : OK", 20, 115);
            doc.text("2. Condamnation : OK", 20, 125);
            doc.text("3. Identification : OK", 20, 135);
            doc.text("4. VAT : OK", 20, 145);
            doc.text("5. Mise à la terre : OK", 20, 155);

            // Signature Image
            const imgData = canvas.toDataURL('image/png');
            doc.text("Signature :", 120, 170);
            doc.addImage(imgData, 'PNG', 120, 180, 60, 40);

            doc.save(`Fiche_Securite_${nom.replace(/ /g,'_')}.pdf`);
        }
    </script>
</body>
</html>
